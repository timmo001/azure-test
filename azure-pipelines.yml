# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - master
  tags:
    include:
      - "*"
    exclude:
      - untagged*
pr:
  - master

variables:
  versionHadolint: "v1.16.3"
  versionShellCheck: "v0.6.0"
  versionBuilder: "1.1"

jobs:
  - job: "Hadolint"
    pool:
      vmImage: "ubuntu-16.04"
    steps:
      - script: sudo docker pull hadolint/hadolint:$(versionHadolint)
        displayName: "Install Hadolint"
      - script: |
          sudo docker run --rm -i \
            -v $(pwd)/.hadolint.yaml:/.hadolint.yaml:ro \
            hadolint/hadolint:$(versionHadolint) < Dockerfile
        displayName: "Run Hadolint"

  - job: "ShellCheck"
    pool:
      vmImage: "ubuntu-16.04"
    steps:
      - script: sudo docker pull koalaman/shellcheck:$(versionShellCheck)
        displayName: "Install ShellCheck"
      - script: |
          sudo docker run --rm -i \
            -v $(pwd):/mnt:ro koalaman/shellcheck:$(versionShellCheck) *.sh
        displayName: "Run ShellCheck"
